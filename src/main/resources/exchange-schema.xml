<?xml version="1.0" encoding="UTF-8"?>
<sbe:messageSchema xmlns:sbe="http://fixprotocol.io/2016/sbe"
                   package="com.exchange.sbe"
                   id="1"
                   version="0"
                   semanticVersion="1.0"
                   description="High Performance Crypto Exchange Protocol"
                   byteOrder="littleEndian">

    <types>
        <composite name="messageHeader" description="Message identifiers and length of message root">
            <type name="blockLength" primitiveType="uint16"/>
            <type name="templateId"  primitiveType="uint16"/>
            <type name="schemaId"    primitiveType="uint16"/>
            <type name="version"     primitiveType="uint16"/>
        </composite>
        
        <!-- Primitive Types -->
        <type name="u64" primitiveType="uint64"/>
        <type name="i64" primitiveType="int64"/>
        <type name="i32" primitiveType="int32"/>
        <type name="u32" primitiveType="uint32"/>
        <type name="u8"  primitiveType="uint8"/>
        
        <!-- Enums -->
        <enum name="Side" encodingType="u8">
            <validValue name="Buy">1</validValue>
            <validValue name="Sell">2</validValue>
        </enum>
        
        <enum name="OrderType" encodingType="u8">
            <validValue name="Limit">1</validValue>
            <validValue name="Market">2</validValue>
        </enum>
        
        <enum name="ExecType" encodingType="u8">
            <validValue name="Trade">1</validValue>
            <validValue name="Cancel">2</validValue>
            <validValue name="Reject">3</validValue>
        </enum>
    </types>

    <!-- 
      Messages 
      NOTE: No variable length data (varData) to ensure Zero-Copy and Zero-Allocation.
    -->
    
    <!-- 1. New Order Single (ID: 100) -->
    <message name="NewOrderSingle" id="100" description="Place a new order">
        <field name="userId"    id="1" type="u64"/>
        <field name="symbolId"  id="2" type="i32"/>
        <field name="price"     id="3" type="i64" description="Price in lowest unit (e.g. satoshis)"/>
        <field name="qty"       id="4" type="i64" description="Quantity"/>
        <field name="side"      id="5" type="Side"/>
        <field name="seqId"     id="6" type="u64" description="Global Sequence ID"/>
        <field name="orderType" id="7" type="OrderType"/>
    </message>

    <!-- 2. Order Cancel (ID: 101) -->
    <message name="OrderCancel" id="101" description="Cancel an existing order">
        <field name="userId"      id="1" type="u64"/>
        <field name="origOrderId" id="2" type="u64"/>
        <field name="symbolId"    id="3" type="i32"/>
        <field name="seqId"       id="4" type="u64"/>
    </message>

    <!-- 5. Deposit (ID: 110) -->
    <message name="Deposit" id="110" description="External Deposit">
        <field name="userId"     id="1" type="u64"/>
        <field name="currencyId" id="2" type="i32"/>
        <field name="amount"     id="3" type="i64"/>
        <field name="seqId"      id="4" type="u64"/>
    </message>

    <!-- 6. Withdraw Request (ID: 111) -->
    <message name="WithdrawRequest" id="111" description="External Withdraw Request">
        <field name="userId"     id="1" type="u64"/>
        <field name="currencyId" id="2" type="i32"/>
        <field name="amount"     id="3" type="i64"/>
        <field name="seqId"      id="4" type="u64"/>
    </message>

    <!-- 3. Order Accepted (ID: 200) -->
    <message name="OrderAccepted" id="200" description="Order accepted by engine">
        <field name="orderId" id="1" type="u64"/>
        <field name="seqId"   id="2" type="u64"/>
        <field name="userId"  id="3" type="u64"/>
    </message>

    <!-- 4. Execution Report (ID: 201) -->
    <message name="ExecutionReport" id="201" description="Trade execution details">
        <field name="matchId"      id="1" type="u64"/>
        <field name="makerOrderId" id="2" type="u64"/>
        <field name="takerOrderId" id="3" type="u64"/>
        <field name="makerUserId"  id="8" type="u64" description="User ID of Maker (or Cancelled Order Owner)"/>
        <field name="takerUserId"  id="9" type="u64" description="User ID of Taker (0 for Cancel)"/>
        <field name="price"        id="4" type="i64"/>
        <field name="qty"          id="5" type="i64"/>
        <field name="side"         id="6" type="Side" description="Side of the Taker"/>
        <field name="execType"     id="7" type="ExecType" description="Type of execution"/>
    </message>

    <!-- 7. OrderBook Snapshot (ID: 202) - Top 5 Levels Simplified -->
    <message name="OrderBookSnapshot" id="202" description="Market Data Snapshot (Top 5)">
        <field name="symbolId"  id="1" type="i32"/>
        <field name="seqId"     id="2" type="u64"/>
        
        <!-- Bids (Buy) Top 5 -->
        <field name="bidPrice0" id="10" type="i64"/> <field name="bidQty0" id="11" type="i64"/>
        <field name="bidPrice1" id="12" type="i64"/> <field name="bidQty1" id="13" type="i64"/>
        <field name="bidPrice2" id="14" type="i64"/> <field name="bidQty2" id="15" type="i64"/>
        <field name="bidPrice3" id="16" type="i64"/> <field name="bidQty3" id="17" type="i64"/>
        <field name="bidPrice4" id="18" type="i64"/> <field name="bidQty4" id="19" type="i64"/>

        <!-- Asks (Sell) Top 5 -->
        <field name="askPrice0" id="30" type="i64"/> <field name="askQty0" id="31" type="i64"/>
        <field name="askPrice1" id="32" type="i64"/> <field name="askQty1" id="33" type="i64"/>
        <field name="askPrice2" id="34" type="i64"/> <field name="askQty2" id="35" type="i64"/>
        <field name="askPrice3" id="36" type="i64"/> <field name="askQty3" id="37" type="i64"/>
        <field name="askPrice4" id="38" type="i64"/> <field name="askQty4" id="39" type="i64"/>
    </message>

</sbe:messageSchema>
